---
page_title: "truenas_vm Resource - terraform-provider-truenas"
subcategory: ""
description: |-
  Manages a QEMU/KVM virtual machine on TrueNAS.
---

# truenas_vm (Resource)

Manages a QEMU/KVM virtual machine on TrueNAS.

## Example Usage

### Basic VM

```terraform
resource "truenas_vm" "basic" {
  name   = "my-vm"
  memory = 2048

  disk {
    path = "/dev/zvol/tank/vms/my-vm-disk0"
    type = "VIRTIO"
  }

  nic {
    type       = "VIRTIO"
    nic_attach = "br0"
  }
}
```

### VM with ISO Installer and Display

```terraform
resource "truenas_vm" "with_installer" {
  name       = "ubuntu-install"
  memory     = 4096
  vcpus      = 2
  cores      = 2
  autostart  = false
  bootloader = "UEFI"
  cpu_mode   = "HOST-PASSTHROUGH"
  state      = "RUNNING"

  disk {
    path = "/dev/zvol/tank/vms/ubuntu-disk0"
    type = "VIRTIO"
  }

  cdrom {
    path = "/mnt/tank/iso/ubuntu-24.04-server.iso"
  }

  nic {
    type       = "VIRTIO"
    nic_attach = "br0"
  }

  display {
    type       = "SPICE"
    resolution = "1920x1080"
    bind       = "0.0.0.0"
    web        = true
  }
}
```

## Import

VMs can be imported using the numeric VM ID:

```shell
terraform import truenas_vm.example 42
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `memory` (Number) Memory in MB (minimum 20).
- `name` (String) VM name.

### Optional

- `autostart` (Boolean) Start VM on boot. Defaults to `true`.
- `bootloader` (String) Bootloader type: `UEFI` or `UEFI_CSM`. Defaults to `UEFI`.
- `bootloader_ovmf` (String) OVMF firmware file. Defaults to `OVMF_CODE.fd`.
- `cdrom` (Block List) CD-ROM/ISO devices. (see [below for nested schema](#nestedblock--cdrom))
- `command_line_args` (String) Extra QEMU command line arguments.
- `cores` (Number) CPU cores per socket. Defaults to `1`.
- `cpu_mode` (String) CPU mode: `CUSTOM`, `HOST-MODEL`, or `HOST-PASSTHROUGH`. Defaults to `CUSTOM`.
- `cpu_model` (String) CPU model name (when cpu_mode is CUSTOM).
- `description` (String) VM description.
- `disk` (Block List) DISK devices (zvol block devices). (see [below for nested schema](#nestedblock--disk))
- `display` (Block List) SPICE display devices. (see [below for nested schema](#nestedblock--display))
- `min_memory` (Number) Minimum memory for ballooning in MB. Null to disable.
- `nic` (Block List) Network interface devices. (see [below for nested schema](#nestedblock--nic))
- `pci` (Block List) PCI passthrough devices. (see [below for nested schema](#nestedblock--pci))
- `raw` (Block List) RAW file devices. (see [below for nested schema](#nestedblock--raw))
- `shutdown_timeout` (Number) Shutdown timeout in seconds (5-300). Defaults to `90`.
- `state` (String) Desired VM power state: `RUNNING` or `STOPPED`. Defaults to `STOPPED`.
- `threads` (Number) Threads per core. Defaults to `1`.
- `usb` (Block List) USB passthrough devices. (see [below for nested schema](#nestedblock--usb))
- `vcpus` (Number) Number of virtual CPU sockets (1-16). Defaults to `1`.

### Read-Only

- `display_available` (Boolean) Whether a display device is available.
- `id` (String) VM ID (numeric, stored as string for Terraform compatibility).

<a id="nestedblock--disk"></a>
### Nested Schema for `disk`

Required:

- `path` (String) Path to zvol device (e.g., `/dev/zvol/tank/vms/disk0`).

Optional:

- `iotype` (String) I/O type: `NATIVE`, `THREADS`, or `IO_URING`. Defaults to `THREADS`.
- `logical_sectorsize` (Number) Logical sector size: `512` or `4096`.
- `order` (Number) Device boot/load order.
- `physical_sectorsize` (Number) Physical sector size: `512` or `4096`.
- `serial` (String) Disk serial number.
- `type` (String) Disk bus type: `AHCI` or `VIRTIO`. Defaults to `AHCI`.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--raw"></a>
### Nested Schema for `raw`

Required:

- `path` (String) Path to raw file.

Optional:

- `boot` (Boolean) Bootable device. Defaults to `false`.
- `iotype` (String) I/O type: `NATIVE`, `THREADS`, or `IO_URING`. Defaults to `THREADS`.
- `logical_sectorsize` (Number) Logical sector size: `512` or `4096`.
- `order` (Number) Device boot/load order.
- `physical_sectorsize` (Number) Physical sector size: `512` or `4096`.
- `serial` (String) Disk serial number.
- `size` (Number) File size in bytes (for creation).
- `type` (String) Disk bus type: `AHCI` or `VIRTIO`. Defaults to `AHCI`.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--cdrom"></a>
### Nested Schema for `cdrom`

Required:

- `path` (String) Path to ISO file (must start with `/mnt/`).

Optional:

- `order` (Number) Device boot/load order.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--nic"></a>
### Nested Schema for `nic`

Optional:

- `mac` (String) MAC address (auto-generated if not set).
- `nic_attach` (String) Host interface to attach to.
- `order` (Number) Device boot/load order.
- `trust_guest_rx_filters` (Boolean) Trust guest RX filters. Defaults to `false`.
- `type` (String) NIC emulation type: `E1000` or `VIRTIO`. Defaults to `E1000`.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--display"></a>
### Nested Schema for `display`

Optional:

- `bind` (String) Bind address. Defaults to `127.0.0.1`.
- `order` (Number) Device boot/load order.
- `password` (String, Sensitive) Connection password.
- `port` (Number) SPICE port (auto-assigned if not set). Range 5900-65535.
- `resolution` (String) Screen resolution. Defaults to `1024x768`. Options: `1920x1200`, `1920x1080`, `1600x1200`, `1600x900`, `1400x1050`, `1280x1024`, `1280x720`, `1024x768`, `800x600`, `640x480`.
- `type` (String) Display protocol. Currently only `SPICE`.
- `wait` (Boolean) Wait for client before booting. Defaults to `false`.
- `web` (Boolean) Enable web client. Defaults to `true`.
- `web_port` (Number) Web client port (auto-assigned if not set).

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--pci"></a>
### Nested Schema for `pci`

Required:

- `pptdev` (String) PCI device address (e.g., `0000:01:00.0`).

Optional:

- `order` (Number) Device boot/load order.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.

<a id="nestedblock--usb"></a>
### Nested Schema for `usb`

Optional:

- `controller_type` (String) USB controller type. Defaults to `nec-xhci`. Options: `piix3-uhci`, `piix4-uhci`, `ehci`, `ich9-ehci1`, `vt82c686b-uhci`, `pci-ohci`, `nec-xhci`, `qemu-xhci`.
- `device` (String) USB device identifier.
- `order` (Number) Device boot/load order.

Read-Only:

- `device_id` (Number) Device ID assigned by TrueNAS.
