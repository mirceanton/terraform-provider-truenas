---
page_title: "TrueNAS Provider"
subcategory: ""
description: |-
  The TrueNAS provider enables Terraform to manage TrueNAS SCALE and Community editions.
---

# TrueNAS Provider

The TrueNAS provider enables Terraform to manage TrueNAS SCALE and Community editions through the midclt API over SSH.

## Features

- **Data Sources**: Query pools and datasets
- **Resources**: Manage datasets, host paths, and applications

## Authentication

The provider currently supports SSH key-based authentication.

## Example Usage

```terraform
terraform {
  required_providers {
    truenas = {
      source  = "deevus/truenas"
      version = "~> 0.1"
    }
  }
}

provider "truenas" {
  host        = "192.168.1.100"
  auth_method = "ssh"

  ssh {
    port                 = 22
    user                 = "root"
    private_key          = file("~/.ssh/truenas_ed25519")
    host_key_fingerprint = "SHA256:..."  # ssh-keyscan <host> | ssh-keygen -lf -
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `auth_method` (String) Authentication method: 'ssh' or 'websocket'. WebSocket requires both websocket and ssh blocks (ssh is used for fallback operations).
- `host` (String) TrueNAS server hostname or IP address.

### Optional

- `max_retries` (Number) Maximum retry attempts for transient connection errors. Default: 3. Set to 0 to disable retries.
- `rate_limit` (Number) Maximum API calls per minute. Default: 300 (5 per second). Set to 0 to disable rate limiting.
- `ssh` (Block, Optional) SSH connection configuration. (see [below for nested schema](#nestedblock--ssh))
- `websocket` (Block, Optional) WebSocket connection configuration. Required when auth_method is 'websocket'. (see [below for nested schema](#nestedblock--websocket))

<a id="nestedblock--ssh"></a>
### Nested Schema for `ssh`

Required:

- `host_key_fingerprint` (String) SHA256 fingerprint of the TrueNAS server's SSH host key. Get it with: ssh-keyscan <host> 2>/dev/null | ssh-keygen -lf -
- `private_key` (String, Sensitive) SSH private key content.

Optional:

- `max_sessions` (Number) Maximum concurrent SSH sessions. Defaults to 5. Increase for large deployments, decrease if you see connection errors.
- `port` (Number) SSH port. Defaults to 22.
- `user` (String) SSH username. Defaults to 'root'.


<a id="nestedblock--websocket"></a>
### Nested Schema for `websocket`

Optional:

- `api_key` (String, Sensitive) TrueNAS API key for authentication.
- `connect_timeout` (Number) Connection timeout in seconds. Defaults to 30.
- `insecure_skip_verify` (Boolean) Skip TLS certificate verification. Defaults to false.
- `max_concurrent` (Number) Maximum concurrent in-flight requests. Defaults to 20.
- `max_retries` (Number) Maximum retry attempts for transient errors. Defaults to 3.
- `port` (Number) WebSocket port. Defaults to 443.
- `username` (String) TrueNAS username associated with the API key. Usually 'root'.

## Requirements

- TrueNAS SCALE or TrueNAS Community
- SSH access to the TrueNAS server
- SSH private key for authentication
- A user with sudo permissions for `midclt`, `rm`, and `rmdir` (see setup below)

## Getting the Host Key Fingerprint

To obtain your TrueNAS server's SSH host key fingerprint:

```bash
# Scan the server and compute fingerprint (no server access needed)
ssh-keyscan -p 22 truenas.local 2>/dev/null | ssh-keygen -lf -
```

This outputs something like:
```
3072 SHA256:xyzABC123...= truenas.local (RSA)
256 SHA256:abcDEF456...= truenas.local (ED25519)
```

Copy the `SHA256:...` portion for your preferred key type into your provider configuration.

**Alternative:** If Terraform fails to connect, the error message will show the server's actual fingerprint. You can verify it matches by running the `ssh-keyscan` command above.

## TrueNAS User Setup

For security, it's recommended to create a dedicated `terraform` user instead of using `root`. This user needs sudo access to run `midclt` commands and file deletion.

### Create the Terraform User

1. In the TrueNAS web UI, navigate to **Credentials > Local Users**
2. Click **Add** to create a new user
3. Configure the user:
   - **Username**: `terraform`
   - **Auxiliary Groups**: `builtin_administrators`
   - **Home Directory**: Choose a path on your pool (e.g., `/mnt/storage/users/terraform`)
   - **Authorized Keys**: Paste your public key (e.g., contents of `~/.ssh/terraform_ed25519.pub`)
   - **Shell**: `bash`
   - **Allowed sudo commands with no password**: `/usr/bin/midclt, /bin/rm, /bin/rmdir`

### Configure the Provider

Update your provider configuration to use the new user:

```terraform
provider "truenas" {
  host        = "192.168.1.100"
  auth_method = "ssh"

  ssh {
    user                 = "terraform"
    private_key          = file("~/.ssh/terraform_ed25519")
    host_key_fingerprint = "SHA256:..."  # ssh-keyscan <host> | ssh-keygen -lf -
  }
}
```
